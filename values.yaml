# Cluster parameters
workersNumber: 2 # @schema description: The number of the worker machines; minimum: 1; type: integer; required: true

# Control plane configuration (hosted in management cluster)
# Three access modes supported:
#   LoadBalancer (default): Hetzner CCM creates a dedicated LB for control plane access
#   NodePort: Set service.type=NodePort + controlPlane.endpoint.host
#   Ingress: Set controlPlane.ingress.apiHost + konnectivityHost (requires HAProxy ingress)
controlPlane: # @schema description: Hosted control plane configuration; type: object
  replicas: 1 # @schema description: Number of control plane pod replicas; minimum: 1; type: integer
  service: # @schema description: Service configuration for control plane access; type: object
    type: "LoadBalancer" # @schema description: Service type (LoadBalancer, NodePort, or ClusterIP for ingress); type: string
    apiNodePort: 30443 # @schema description: NodePort for Kubernetes API access (only for NodePort mode); type: integer; minimum: 30000; maximum: 32767
    konnectivityNodePort: 30132 # @schema description: NodePort for konnectivity server (only for NodePort mode); type: integer; minimum: 30000; maximum: 32767
  endpoint: # @schema description: Control plane endpoint configuration; type: object
    host: "" # @schema description: Management cluster node/LB IP (required for NodePort mode, optional for LoadBalancer); type: string

clusterNetwork: # @schema description: The cluster network configuration; type: object
  pods: # @schema description: The network ranges from which Pod networks are allocated; type: object
    cidrBlocks: # @schema description: A list of CIDR blocks; type: array; item: string
      - "10.244.0.0/16"
  services: # @schema description: The network ranges from which service VIPs are allocated; type: object
    cidrBlocks: # @schema description: A list of CIDR blocks; type: array; item: string
      - "10.96.0.0/12"

clusterLabels: {} # @schema description: Labels to apply to the cluster; type: object; additionalProperties: true
clusterAnnotations: {} # @schema description: Annotations to apply to the cluster; type: object; additionalProperties: true

# Hetzner cluster parameters
region: "" # @schema description: The Hetzner region name (e.g., fsn1, nbg1, hel1); type: string; required: true
sshKeyNames: [] # @schema description: SSH key names to use for cluster nodes; type: array; item: string
tokenRef: # @schema description: Reference to the secret containing Hetzner API token; type: object
  name: "" # @schema description: Name of the secret; type: string; required: true
  key: "hcloud-token" # @schema description: Key in the secret containing the token; type: string; required: true
placementGroupName: "" # @schema description: Name of the placement group to use for nodes; type: string
labels: {} # @schema description: Labels to apply to Hetzner resources; type: object; additionalProperties: true
controlPlaneLoadBalancer: # @schema description: Control plane load balancer configuration; type: object
  extraServices: [] # @schema description: Additional services to expose through the load balancer; type: array; item: object
hcloudNetwork: # @schema description: Hetzner private network configuration; type: object
  enabled: true # @schema description: Enable private network for the cluster; type: boolean
  cidrBlock: "10.0.0.0/16" # @schema description: CIDR block for the private network; type: string
  subnetCidrBlock: "10.0.0.0/24" # @schema description: Subnet CIDR block for the private network; type: string
  networkZone: "eu-central" # @schema description: Network zone for the private network; type: string
  
# Hetzner worker machine parameters
worker: # @schema description: The configuration of the worker machines; type: object
  image: ubuntu-24.04 # @schema description: The name of the Hetzner server image; type: string; required: true
  type: cpx22 # @schema description: The type of Hetzner server to create (e.g., cx21, cpx21, cx31); type: string; required: true
  placementGroupName: "" # @schema description: The placement group name for worker nodes; type: string
  dataDisks: [] # @schema description: Additional data disks to attach; type: array; item: object
  additionalSecurityGroups: [] # @schema description: Additional security groups to attach; type: array; item: object

# k0s parameters
k0s: # @schema description: k0s specific settings; type: object
  version: v1.34.3+k0s.0 # @schema description: The k0s version to use; type: string; required: true
  arch: amd64 # @schema description: k0s binary architecture; type: string
  api: # @schema description: k0s API configuration; type: object
    extraArgs: {} # @schema description: Extra arguments for the k0s API; type: object; additionalProperties: true
  network: # @schema description: Network configuration for k0s; type: object
    provider: custom # @schema description: Network provider (custom to disable default CNI); type: string

# Worker k0s configuration
workerConfig: # @schema description: The configuration of the k0s worker; type: object
  args: # @schema description: Extra arguments passed to the k0s worker; type: array; item: string
    - --enable-cloud-provider
    - --kubelet-extra-args="--cloud-provider=external"
  postStartCommands: [] # @schema title: Post-start commands; description: Additional commands to run after k0s start; type: array; item: string
  preInstallCommands: [] # @schema title: Pre-install commands; description: Additional commands to run before k0s install; type: array; item: string
  files: [] # @schema description: Additional files to provision on worker nodes; type: array; items: object

# NOTE: Cloud Controller Manager (CCM) is no longer deployed by this chart
# The CCM must be deployed separately to the user cluster after provisioning
# Use: kubectl --kubeconfig=<user-cluster-kubeconfig> apply -f manifests/user-cluster/hcloud-ccm-user-cluster.yaml
# 
# This change was made because the CCM needs to run in the user cluster,
# not in the management cluster where the Helm chart is installed.
